## DNS

DNS은 인터넷 상에서 도메인 이름을 IP 주소로 변환해주는 시스템이다.

DNS는 계층적 구조로 이루어져 있다. 최상위 계층에서는 .com, .org, .edu, .net 등의 도메인 이름들이 정의되어 있으며, 그 아래 계층에서는 구체적인 도메인 이름들이 정의된다.

DNS는 도메인 이름을 IP 주소로 변환하기 위해 DNS 서버를 사용한다. 일반적으로, 인터넷 서비스 제공자(ISP)는 자신의 DNS 서버를 운영하며, 이 DNS 서버를 통해 사용자가 접속하려는 도메인 이름에 해당하는 IP 주소를 얻어온다. DNS 서버는 요청한 도메인 이름에 대한 IP 주소를 캐싱하여, 동일한 도메인 이름에 대한 다음 요청 시에는 캐시된 IP 주소를 사용하여 빠른 응답을 제공한다.

### DNS 요청 흐름
1. 먼저 PC 내의 DNS 캐시를 뒤진다.
2. PC 내의 hosts 파일을 뒤진다.
3. 공유기가 DNS forwarding 기능을 제공한다면 공유기가 DNS 얻어와준다.
4. 만약 DNS forwarding 기능이 없다면 ISP에서 운영하는 DNS를 뒤져서 원하는 IP를 찾아온다.

> DNS 요청을 매번 실제 DNS 서버가 처리한다면 시간이 많이 걸릴 것이다. 따라서 자주 사용한 주소는 캐시를 통해 빠르게 IP를 얻어올 수 있다.
## DNS 스풀링

DNS 스풀링은 해커가 DNS 서버의 **캐시를 조작하여, 사용자가 접속하려는 웹 사이트 주소를 조작하는 공격 기법**이다.

DNS 스풀링 공격에서는 해커가 DNS 서버의 캐시를 조작하여, 사용자가 접속하려는 **도메인 이름에 대한 IP 주소를 조작**한다. 이를 통해, 사용자가 접속하려는 웹 사이트의 IP 주소를 해커가 지정한 악성 웹 사이트의 IP 주소로 변경하여, 사용자를 악성 웹 사이트로 유도한다.

**방지하기 위한 방법**
- 안전한 DNS 서버를 사용
- SSL을 사용
- DNSSEC(Domain Name System Security Extensions)와 같은 기술을 사용 (DNS 응답 암호화)


## DNS 라운드 로빈

DNS 라운드 로빈(Round Robin)은 DNS(Domain Name System) 서버에서 여러 대의 웹 서버를 등록하고, 요청이 들어올 때마다 순차적으로 웹 서버를 선택하여 요청을 전달하는 방식이다.
이를 통해, 부하 분산(Load Balancing)을 구현할 수 있다.

DNS 라운드 로빈은 다수의 웹 서버를 운영하는 대형 웹 사이트에서, 각각의 웹 서버에 대한 부하를 분산시키기 위해 사용된다. DNS 라운드 로빈 방식에서는, 여러 대의 웹 서버 IP 주소를 DNS 레코드에 등록하고, 클라이언트가 해당 도메인 이름으로 접속을 시도하면 DNS 서버가 등록된 웹 서버 IP 주소 중 하나를 선택하여 응답을 전달한다.

**DNS 라운드 로빈의 장점**
- DNS 라운드 로빈 방식은 구현이 간단하고 비용이 저렴하며, 여러 대의 웹 서버를 사용하는 경우 효과적이다.

**DNS 라운드 로빈의 단점**

- 서버의 수 만큼 공인 IP 주소가 필요하다. -> 로드밸런싱은 공인 IP 하나로 모든 트래픽을 받고 나머지 서버는 사설 IP 사용
- 서버에 장애가 발생해도 감지하지 않고 부하 분산시킨다 -> 로드밸런싱은 주기적으로 서버에 헬스 체크 하지만 DNS 라운드로빈은 체크 안한다.
- DNS 결과를 캐싱하기 때문에 균등한 부하 분산이 어렵다.
- 로드밸런싱 대상인 서버가 모두 동일한 스펙일때 효과가 있다.

### 대안이 될 수 있는 로드밸런싱 알고리즘

- Weighted Round Robin : 웹서버 각각에 가중치를 두고 로드밸런싱을 진행할 수 있다.
- Least Connection : 현재 가장 클라이언트 접속이 적은 서버로 로드밸런싱을 진행한다. 각 서버의 커넥션 수 알아야하므로 라운드 로빈만으로는 구현 불가능


### Route 53을 통한 DNS 로드밸런싱

![스크린샷 2023-03-20 오후 8.52.51.png](..%2F..%2F..%2FDesktop%2F%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202023-03-20%20%EC%98%A4%ED%9B%84%208.52.51.png)

기존의 DNS 로드밸런싱은 헬스 체크를 하지 못한다는 단점이 있다. 하지만 AWS의 Route 53은 헬스 체크 기능을 제공한다. 

### DNS 로드밸런싱 환경에서의 세션

만약 클라이언트와 특정 서버가 세션을 유지하고 있다면 DNS 로드밸런싱을 통해 다른 IP의 서버에 접속할 경우 세션이 끊어질 수 있다. 따라서 세션 클러스터링 같은 적절한 보완책을 사용해야 한다.